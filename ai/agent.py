from ai.ai import GigaChatt

ai_client = GigaChatt()


async def generate_text(prompt: str) -> str:
    return ai_client.ask(prompt)


async def check_essay(text: str) -> str:
    prompt = f"""Ты - опытный преподаватель русского языка и литературы. Проведи комплексную проверку сочинения и дай развернутый анализ:

1. Орфография:
   - Найдите и исправьте орфографические ошибки
   - Укажите правило для каждой ошибки

2. Пунктуация:
   - Проверьте расстановку знаков препинания
   - Исправьте ошибки, объясните правила

3. Грамматика:
   - Проверьте согласование, управление, примыкание
   - Исправьте грамматические ошибки

4. Стилистика:
   - Оцените уместность лексики
   - Отметьте речевые ошибки (тавтология, плеоназм, канцеляризмы)
   - Проверьте стилистическое единство

5. Логика и композиция:
   - Оцените логическую связность
   - Проверьте структуру (введение, основная часть, заключение)
   - Отметьте нарушения последовательности

6. Содержание:
   - Оцените раскрытие темы
   - Проверьте аргументацию
   - Оцените глубину анализа

7. Общие рекомендации:
   - Дайте конкретные рекомендации по улучшению
   - Предложите альтернативные формулировки
   - Укажите сильные стороны работы

8. Оценка (по 10-балльной шкале):
   - Орфография и пунктуация: [оценка]
   - Грамматика и стилистика: [оценка]
   - Логика и композиция: [оценка]
   - Содержание: [оценка]
   - ИТОГОВАЯ ОЦЕНКА: [оценка]

Сочинение для проверки:
{text}

Предоставь ответ в структурированном виде с выделением ошибок и объяснениями."""

    return await generate_text(prompt)


async def write_essay(topic: str, template: str = None) -> str:
    if template:
        prompt = f"Напиши качественное, грамотное сочинение на тему: '{topic}'. Используй следующую структуру и рекомендации:\n{template}\n\nСочинение должно быть логичным, аргументированным и стилистически выверенным."
    else:
        prompt = f"Напиши качественное сочинение на тему: '{topic}'. Сочинение должно иметь четкую структуру: введение с тезисом, основную часть с 2-3 аргументами и примерами, заключение с выводами. Используй литературный русский язык, избегай штампов и клише."

    return await generate_text(prompt)